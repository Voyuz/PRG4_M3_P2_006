<!DOCTYPE html>
<html lang="id">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Manajemen Transaksi</title>
      <link
         href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
         rel="stylesheet"
      />
   </head>
   <body class="bg-light">
      <div class="container mt-5">
         <h2 class="text-center mb-4">ðŸ“‹ Manajemen Transaksi</h2>

         <!-- Form Create / Update -->
         <div class="card p-4 mb-4">
            <h4 id="form-title">Tambah Transaksi</h4>
            <form id="transaksiForm">
               <input type="hidden" id="id_transaksi" />

               <div class="mb-3">
                  <label for="nama" class="form-label">Nama</label>
                  <input
                     type="text"
                     id="nama"
                     class="form-control"
                     placeholder="Masukkan nama"
                     required
                  />
               </div>

               <div class="mb-3">
                  <label for="produk" class="form-label">Produk</label>
                  <input
                     type="text"
                     id="produk"
                     class="form-control"
                     placeholder="Nama produk"
                     required
                  />
               </div>

               <div class="mb-3">
                  <label for="jumlah" class="form-label">Jumlah</label>
                  <input
                     type="number"
                     id="jumlah"
                     class="form-control"
                     placeholder="Jumlah barang"
                     required
                  />
               </div>

               <div class="mb-3">
                  <label for="total" class="form-label">Total Harga</label>
                  <input
                     type="number"
                     id="total"
                     class="form-control"
                     placeholder="Total harga"
                     required
                  />
               </div>

               <button type="submit" class="btn btn-primary" id="btnSubmit">
                  Simpan Transaksi
               </button>
               <button
                  type="button"
                  class="btn btn-secondary"
                  id="btnCancel"
                  style="display: none"
               >
                  Batal
               </button>
            </form>
         </div>

         <!-- Tabel Data -->
         <div class="card p-4">
            <h4>Data Transaksi</h4>
            <table class="table table-bordered mt-3 text-center align-middle">
               <thead class="table-dark">
                  <tr>
                     <th>ID</th>
                     <th>Nama</th>
                     <th>Produk</th>
                     <th>Jumlah</th>
                     <th>Total</th>
                     <th>Aksi</th>
                  </tr>
               </thead>
               <tbody id="tabelData">
                  <tr>
                     <td colspan="6">Memuat data...</td>
                  </tr>
               </tbody>
            </table>
         </div>
      </div>

      <script>
         const apiRead = "https://api.roniprsty.com/transaksi/read.php";
         const apiCreate = "https://api.roniprsty.com/transaksi/create.php";
         const apiUpdate = "https://api.roniprsty.com/transaksi/update.php";

         const tabel = document.getElementById("tabelData");
         const form = document.getElementById("transaksiForm");
         const btnSubmit = document.getElementById("btnSubmit");
         const btnCancel = document.getElementById("btnCancel");
         const formTitle = document.getElementById("form-title");

         // ðŸ”¹ Fungsi untuk ambil data (READ)
         async function loadData() {
            tabel.innerHTML = "<tr><td colspan='6'>Memuat data...</td></tr>";
            const res = await fetch(apiRead);
            const data = await res.json();
            if (data && data.data) {
               tabel.innerHTML = data.data
                  .map(
                     (row) => `
          <tr>
            <td>${row.id_transaksi}</td>
            <td>${row.nama}</td>
            <td>${row.produk}</td>
            <td>${row.jumlah}</td>
            <td>${row.total}</td>
            <td>
              <button class="btn btn-warning btn-sm" onclick="editData('${row.id_transaksi}', '${row.nama}', '${row.produk}', '${row.jumlah}', '${row.total}')">Edit</button>
            </td>
          </tr>
        `
                  )
                  .join("");
            } else {
               tabel.innerHTML =
                  "<tr><td colspan='6'>Tidak ada data ditemukan</td></tr>";
            }
         }

         loadData();

         // ðŸ”¹ Fungsi untuk tambah / update data
         form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const id = document.getElementById("id_transaksi").value;
            const nama = document.getElementById("nama").value;
            const produk = document.getElementById("produk").value;
            const jumlah = document.getElementById("jumlah").value;
            const total = document.getElementById("total").value;

            const payload = { id_transaksi: id, nama, produk, jumlah, total };

            const url = id ? apiUpdate : apiCreate;

            const res = await fetch(url, {
               method: "POST",
               headers: { "Content-Type": "application/json" },
               body: JSON.stringify(payload),
            });

            const result = await res.json();
            alert(result.message || "Operasi berhasil");

            form.reset();
            btnCancel.style.display = "none";
            btnSubmit.textContent = "Simpan Transaksi";
            formTitle.textContent = "Tambah Transaksi";
            loadData();
         });

         // ðŸ”¹ Fungsi untuk edit data
         function editData(id, nama, produk, jumlah, total) {
            document.getElementById("id_transaksi").value = id;
            document.getElementById("nama").value = nama;
            document.getElementById("produk").value = produk;
            document.getElementById("jumlah").value = jumlah;
            document.getElementById("total").value = total;

            btnSubmit.textContent = "Update Transaksi";
            btnCancel.style.display = "inline-block";
            formTitle.textContent = "Ubah Transaksi";
         }

         // ðŸ”¹ Batal update
         btnCancel.addEventListener("click", () => {
            form.reset();
            document.getElementById("id_transaksi").value = "";
            btnSubmit.textContent = "Simpan Transaksi";
            btnCancel.style.display = "none";
            formTitle.textContent = "Tambah Transaksi";
         });
      </script>
   </body>
</html>
